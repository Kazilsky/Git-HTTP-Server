{% extends "base.html" %}

{% block title %}{{ repo.name }} - Gitea –ö–ª–æ–Ω{% endblock %}

{% block content %}
<div class="repo-page">
    <div class="repo-header">
        <h1><a href="/user/{{ owner.username }}">{{ owner.username }}</a> / {{ repo.name }}</h1>
        <p class="repo-description">{{ repo.description | default(value="–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è") }}</p>
        <div class="repo-meta">
            <span class="visibility">{% if repo.is_public %}"–ü—É–±–ª–∏—á–Ω—ã–π"{% else %}"–ü—Ä–∏–≤–∞—Ç–Ω—ã–π"{% endif %}</span>
            <span class="created-at">–°–æ–∑–¥–∞–Ω: {{ repo.created_at }}</span>
        </div>
    </div>

    <div class="repo-actions">
        <div class="clone-url">
            <input type="text" readonly value="http://localhost:8000/git/{{ repo.name }}" id="clone-url">
            <button class="btn btn-sm" onclick="copyToClipboard('clone-url')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <div class="btns">
            <a href="/repo/{{ repo.name }}/archive/master.zip" class="btn btn-sm">–°–∫–∞—á–∞—Ç—å ZIP</a>
        </div>
    </div>

    <div class="repo-tabs">
        <ul>
            <li class="active"><a href="/repo/{{ repo.name }}">–ö–æ–¥</a></li>
            <li><a href="/repo/{{ repo.name }}/commits">–ò—Å—Ç–æ—Ä–∏—è</a></li>
            <li><a href="/repo/{{ repo.name }}/branches">–í–µ—Ç–∫–∏</a></li>
        </ul>
    </div>

    {% if branches and branches|length > 0 %}
    <div class="repo-content">
        <div class="branch-selector">
            <select id="branch-select" onchange="changeBranch()">
                {% for branch in branches %}
                <option value="{{ branch }}">{{ branch }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="files-list">
            {% if files and files|length > 0 %}
            <table>
                <thead>
                    <tr>
                        <th>–ò–º—è</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ</th>
                        <th>–°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in files %}
                    <tr>
                        <td>
                            <a href="/repo/{{ repo.name }}/blob/{{ current_branch }}/{{ file.path }}">
                                {% if file.type == "dir" %}üìÅ{% else %}üìÑ{% endif %} {{ file.name }}
                            </a>
                        </td>
                        <td>{{ file.last_commit.date }}</td>
                        <td>{{ file.last_commit.message }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-repo">
                <p>–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—É—Å—Ç. –í–æ—Ç –∫–∞–∫ –µ–≥–æ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å:</p>
                <div class="setup-instructions">
                    <h3>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</h3>
                    <pre><code>git clone http://localhost:8000/git/{{ repo.name }}
cd {{ repo.name }}
echo "# {{ repo.name }}" >> README.md
git add README.md
git commit -m "Initial commit"
git push -u origin master</code></pre>

                    <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</h3>
                    <pre><code>cd existing_repo
git remote add origin http://localhost:8000/git/{{ repo.name }}
git push -u origin master</code></pre>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="empty-repo">
        <p>–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—É—Å—Ç. –í–æ—Ç –∫–∞–∫ –µ–≥–æ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å:</p>
        <div class="setup-instructions">
            <h3>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</h3>
            <pre><code>git clone http://localhost:8000/git/{{ repo.name }}
cd {{ repo.name }}
echo "# {{ repo.name }}" >> README.md
git add README.md
git commit -m "Initial commit"
git push -u origin master</code></pre>

            <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</h3>
            <pre><code>cd existing_repo
git remote add origin http://localhost:8000/git/{{ repo.name }}
git push -u origin master</code></pre>
        </div>
    </div>
    {% endif %}

    {% if commits and commits|length > 0 %}
    <div class="recent-commits">
        <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã</h3>
        <div class="commits-list">
            {% for commit in commits %}
            <div class="commit-item">
                <div class="commit-message">
                    <a href="/repo/{{ repo.name }}/commit/{{ commit.hash }}">{{ commit.message }}</a>
                </div>
                <div class="commit-meta">
                    <span class="commit-author">{{ commit.author }}</span>
                    <span class="commit-date">{{ commit.date }}</span>
                    <span class="commit-hash">{{ commit.hash | slice(start=0, end=7) }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    document.execCommand('copy');
}

function changeBranch() {
    const branch = document.getElementById('branch-select').value;
    window.location.href = `/repo/{{ repo.name }}/tree/${branch}`;
}
</script>
{% endblock %} 